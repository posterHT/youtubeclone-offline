<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>
    <script>
        link = "vOhnVFLDiyg";
        format = "480";
        start = 1;
        end = 1;



        $.get("test.php?format=" + format + "&video_url=" + encodeURI(link), function (data) {
            p(data.id);
        }, "json");


        function p(i) {
            $.get("https://loader.to/ajax/progress.php?id=" + i, function (data, status) {

                console.log("Link Loading " + data.progress + "%")
                if (data.download_url != null && data.success == 1) {
                    console.log(data.download_url);                   
                    $.get("downloadvideo.php?link=" + data.download_url + "&id=" + link, function (data) {
                        if (data == "success")
                            console.log("Download Success");
                        else
                            console.log("Download Failed!");
                    })
                    return;
                }
                setTimeout(p.bind(null, i), 750);
            }, "json").fail(function () {
                setTimeout(p.bind(null, i), 750);
            });
        } //automatic country determination. function initCountry(){ return new Promise((resolve, reject)=>{ var xhr=new XMLHttpRequest(); xhr.timeout=3000; xhr.onreadystatechange=function (){ if (this.readyState==4){ if (this.status==200){ countryCode=countryCodeExpression.exec(this.responseText) ip=userIPExpression.exec(this.responseText) if (countryCode===null || countryCode[1]==='' || ip===null || ip[1]===''){ reject('IP/Country code detection failed');} let result={ "countryCode":countryCode[1], "IP":ip[1]}; user_country=countryCode[1]; resolve(result)} else{ reject(xhr.status)}}} xhr.ontimeout=function (){ reject('timeout')} xhr.open('GET', 'https://www.cloudflare.com/cdn-cgi/trace', true); xhr.send();});} initCountry(); 

    </script>
</body>

</html>